---
marp: true
theme: honwaka
paginate: true
math: mathjax
---

<div id="ch06"></div>


<!-- _class: lead-->

# æ©Ÿæ¢°å­¦ç¿’è¬›ç¿’ä¼š ç¬¬å…­å›
## - ã€Œãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å®Ÿè£…ã€


**traP Kaggleç­**
2024/07/10


---

<!-- _header: ä»Šæ—¥ã™ã‚‹ã“ã¨ -->

- PyTorch ã‚’ä½¿ã£ã¦å®Ÿéš›ã«ã‚ã‚‹æƒ…å ±ã‚’äºˆæ¸¬ã™ã‚‹ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å®Ÿè£…ã—ã¾ã™
- ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰, å­¦ç¿’, äºˆæ¸¬ã¾ã§ã‚’ä¸€é€šã‚Šã‚„ã£ã¦ã¿ã¾ã™
- **ãŠé¡Œã¨ã—ã¦ä»Šæ—¥ã‹ã‚‰å§‹ã‚ã‚‹ã‚³ãƒ³ãƒšã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„ã¾ã™.**
  - <span class="lined">**1 Sub ã¾ã§ä¸€æ°—ã«è¡Œãã¾ã™ï¼ï¼**</span> 

---

<!-- _header: ã¯ã˜ã‚ã« -->


<div style="text-align: center;">

å…ˆã«ã€ã‚³ãƒ³ãƒšã®ãƒ«ãƒ¼ãƒ«ãªã©ã®è©±ã‚’ã—ã¾ã™ã€€

https://abap34.github.io/ml-lecture/supplement/competetion.pdf

(â€» ã‚ã¨ã‹ã‚‰ã“ã®è³‡æ–™ã‚’èª­ã‚“ã§ã„ã‚‹äººã¯é£›ã°ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™)

</div>

---

<!-- _header: ä»Šå›ã®ã‚³ãƒ³ãƒšã®ãŠé¡Œ ~ ã‚ã‚‰ã™ã˜ ~ -->

æ©Ÿæ¢°å­¦ç¿’è¬›ç¿’ä¼šç”¨ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¸ãƒ£ãƒƒã‚¸ã‚’ä½œã£ãŸ `@abap34` ã¯å›°ã£ã¦ã„ã¾ã—ãŸ.

æ”»æ’ƒã¯ã‚„ã‚ã¦ãã ã•ã„ã¨æ›¸ã„ã¦ã‚ã‚‹ã®ã«ã²ã£ãã‚Šãªã—ã«æ”»æ’ƒãŒä»•æ›ã‘ã‚‰ã‚Œã‚‹ã‹ã‚‰ã§ã™.


éƒ¨å“¡ã®å€‹äººæƒ…å ±ã¨ã‚µãƒ¼ãƒã¨ãƒ¢ãƒ©ãƒ«ãŒå¿ƒé…ã«ãªã£ãŸ `@abap34` ã¯, é£›ã‚“ã§ãã‚‹é€šä¿¡ã‚’æ©Ÿæ¢°å­¦ç¿’ã‚’ä½¿ã£ã¦æ”»æ’ƒã‹ã‚’åˆ¤å®šã™ã‚‹ã“ã¨ã§æ”»æ’ƒã‚’æœªç„¶ã«é˜²ãã“ã¨ã«ã—ã¾ã—ãŸ.

<br>


![bg blur:6px opacity:.2](img/image-9.png)

ã‚ãªãŸã®ä»•äº‹ã¯ã“ã‚Œã‚’é«˜ã„ç²¾åº¦ã§ãŠã“ãªãˆã‚‹æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã™.

<div class="cite">

â€» æ¶ç©ºã®è©±ã§ã™. åƒ•ã®çŸ¥ã‚‹é™ã‚Šã‚¸ãƒ£ãƒƒã‚¸ã‚µãƒ¼ãƒã¸ã®æ”»æ’ƒã¯ä»Šã®ã¨ã“ã‚ãã¦ã„ãªã„ã§ã™.

</div>


---

<!-- _header: ãƒ‡ãƒ¼ã‚¿ -->

é€šä¿¡ãƒ­ã‚°ã‹ã‚‰å¿…è¦ãã†ãªæƒ…å ±ã‚’æŠ½å‡ºã—ãŸã‚‚ã® (<span class="lined">**è©³ç´°ã¯ Data ã‚¿ãƒ–ã‹ã‚‰**</span>)

<div class="box">

- æ¥ç¶šæ™‚é–“
- ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°
- éå»2ç§’é–“ã®æ¥ç¶šå›æ•°
- ç‰¹åˆ¥ãªãƒ¦ãƒ¼ã‚¶å (`root`, `admin` `guest` ã¨ã‹) ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ãŸã‹ï¼Ÿã€€

<div style="text-align: center;">


$\vdots$

</div>

</div>

---

<!-- _header: ãƒ‡ãƒ¼ã‚¿ -->

<br>
<br>


- train.csv
  - å­¦ç¿’ã«ä½¿ã†ãƒ‡ãƒ¼ã‚¿
- train_tiny.csv **(ğŸ‘ˆ æ™‚é–“ã¨èª¬æ˜ã®éƒ½åˆä¸Š ä»Šæ—¥ã¯ã“ã‚Œã‚’ä½¿ã„ã¾ã™)**
  - å­¦ç¿’ã«ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã®ä¸€éƒ¨ã‚’å–ã‚Šå‡ºã—,ä¸€éƒ¨ã‚’å‰Šé™¤
- test.csv
  - äºˆæ¸¬å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿
- test_tiny.csv **(ğŸ‘ˆ æ™‚é–“ã¨èª¬æ˜ã®éƒ½åˆä¸Š ä»Šæ—¥ã¯ã“ã‚Œã‚’ä½¿ã„ã¾ã™)**
  - äºˆæ¸¬å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã®æ¬ æå€¤ã‚’åŸ‹ã‚ã¦,ä¸€éƒ¨ã®ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤
- sample_suboldsymbolission.csv
  - äºˆæ¸¬ã®æå‡ºæ–¹å¼ã®ã‚µãƒ³ãƒ—ãƒ« (å€¤ã¯ã§ãŸã‚‰ã‚)


![w:1200](image/train_img.png)





---


<!-- _header: å…¨ä½“ã®æµã‚Œ -->

1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
3. ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
4. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹äºˆæ¸¬
5. é †ä½è¡¨ã¸ã®æå‡º


---

<!-- _header: å…¨ä½“ã®æµã‚Œ1 ~ãƒ¢ãƒ‡ãƒ«ã«å…¥åŠ›ã™ã‚‹ã¾ã§ -->

<br>
<br>

<div style="text-align: center;">

## 1-0. ãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

â‡©

## 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿

â‡©

## 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†

â‡©

## 1-2. PyTorchã«å…¥åŠ›ã§ãã‚‹å½¢ã«

</div>

---

<!-- _header: 1-0. ãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->

<div style="text-align: center;">

âœ… ã‚»ãƒ«ã«ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ

</div>

```bash
!curl https://www.abap34.com/trap_ml_lecture/public-data/train_tiny.csv -o train.csv
!curl https://www.abap34.com/trap_ml_lecture/public-data/test_tiny.csv -o test.csv
!curl https://www.abap34.com/trap_ml_lecture/public-data/sample_submission.csv -o sample_submission.csv
```

![center h:280](img/image-21.png)


<div class="cite">

Jupyter Notebook ã§ã¯,å…ˆé ­ã« `!` ã‚’ã¤ã‘ã‚‹ã“ã¨ã§,ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™.

</div>

---


<!-- _header: 1-0. ãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->



âœ… å·¦ã® ğŸ“ > train.csv, test.csv, sample_submission.csv ã§è¡¨ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ãŸã‚‰ OKï¼


![center h:350](img/image-23.png)

<div class="cite">

ä»Šå›ã®ã‚³ãƒ³ãƒšã®ãƒ‡ãƒ¼ã‚¿ã¯ ISCX NSL-KDD dataset 2009 [1] ã‚’ã‚‚ã¨ã«å¤§ããåŠ å·¥ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
[1] M. Tavallaee, E. Bagheri, W. Lu, and A. Ghorbani, â€œA Detailed Analysis of the KDD CUP 99 Data Set,â€ Submitted to Second IEEE Symposium on Computational Intelligence for Security and Defense Applications (CISDA), 2009.

</div>


---


<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->


<div class="thm">

<div style="text-align: center;">

âœ… `pd.read_csv(path)` ã§,`path` ã«ã‚ã‚‹csvãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã‚‹

</div>


</div>

```python
# pandas ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ `pd` ã¨ã„ã†åå‰ã‚’ã¤ã‘ã¦import
import pandas as pd

# ã“ã‚Œã«ã‚ˆã£ã¦, pandas ã®é–¢æ•°ã‚’ `pd.é–¢æ•°å` ã¨ã„ã†å½¢ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹
train = pd.read_csv("train.csv")
test = pd.read_csv("test.csv")
```


<div class="cite">


ãƒ‘ã‚¹ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚©ãƒ«ãƒ€ã¸ã®çµŒè·¯ã®ã“ã¨ã§ã™.
ä»Šå›ã¯ train.csv ã¨ test.csv ãŒãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã¨åŒã˜éšå±¤ã«ã‚ã‚‹ã®ã§, train.csv ã¨ test.csv ã¾ã§ã®çµŒè·¯ã¯,ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãã®ã¾ã¾æŒ‡å®šã™ã‚‹ã ã‘ã§å¤§ä¸ˆå¤«ã§ã™.
ã»ã‹ã«ã‚‚ ãŸã¨ãˆã° `../train.csv` ã¨æŒ‡å®šã™ã‚‹ã¨ ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã®ä¸€ã¤ä¸Šã®éšå±¤ã«ã‚ã‚‹ train.csv ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™.


</div>

---

<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->


![w:1200](img/image-12.png)

<div class="cite">

<span class="lined">**ã‚»ãƒ«ã«å˜ã«å¤‰æ•°ã‚’ã‹ãã¨ä¸­èº«ã‚’ç¢ºèªã§ãã¾ã™ï¼**</span>ã€€(Jupyter Notebook ã®å„ã‚»ãƒ«ã¯æœ€å¾Œã«è©•ä¾¡ã•ã‚ŒãŸå€¤ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã§ã™) 
ã•ã£ã¨ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã¨ãã«ä¾¿åˆ©ã§ã™. ä¸­èº«ãŒã‚ã‹ã‚‰ãªããªã£ãŸã‚‰ã¨ã‚Šã‚ãˆãšæ›¸ã„ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†.

</div>

---

<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->

<div style="text-align: center;">


ä»Šã¾ã§
â‡©

</div>



```python
x = [1, 2, 3, 4, 5]
y = [2, 4, 6, 8, 10]

def loss(a):
...
```

<div style="text-align: center;">

â‡©

ä»Šå›ã‚‚å…¥åŠ›ã¨å‡ºåŠ› (ã®ç›®æ¨™) ã«ã‚ã‘ã¦ãŠã


</div>



---


<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->

```python
train['ã‚«ãƒ©ãƒ å']
```

ã§ã€Œã‚«ãƒ©ãƒ åã€ã¨ã„ã†åå‰ã®åˆ—ã‚’å–ã‚Šå‡ºã›ã‚‹ ğŸ“

<div style="text-align: center;">

â‡©

</div>

ä»Šå›ã®äºˆæ¸¬ã®ç›®æ¨™ã¯

```python
train['class']
```

<div style="text-align: center;">

â‡©

</div>

---


<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->


```python
train_y = train['class']
```

â‡¨ **`train_y` ã«æ”»æ’ƒ? or é€šå¸¸? ã®åˆ—ãŒå…¥ã‚‹ğŸ™Œ**

![bg right h:450](img/image-13.png)


---

<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->



æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã¯ <span class="dot-text">ç›´æ¥çš„ã«ã¯</span> æ•°ä»¥å¤–ã¯æ‰±ãˆãªã„ã®ã§æ•°ã«å¤‰æ›ã—ã¦ãŠã.

```python
train_y = train['class'].map({
  'normal': 0,
  'attack': 1
})
```



![bg right h:450](img/image-18.png)


---


<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->

**é€†ã«, ãƒ¢ãƒ‡ãƒ«ã«å…¥åŠ›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ `train` ã‹ã‚‰ <span class="">ã•ã£ãã®åˆ— <span style="color: gray;">(ã¨ `id`) </span> ã‚’é™¤ã„ãŸã‚‚ã®ï¼**</span>

```python
train.drop(columns=['ã‚«ãƒ©ãƒ å'])
```

ã‚’ä½¿ã†ã¨ `train` ã‹ã‚‰ã€Œã‚«ãƒ©ãƒ åã€ã¨ã„ã†åå‰ã® **åˆ—ã‚’é™¤ã„ãŸã‚‚ã®** ã‚’å–ã‚Šå‡ºã›ã‚‹

<div style="text-align: center;">

â‡©

ä»Šå›ã¯ <span class="" style="font-size: 1.5em;">`train.drop(columns=['id', 'class'])`</span>

</div>



---

<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->

```python
train_x = train.drop(columns=['id', 'class'])
test_x = test.drop(columns=['id'])
```


â‡¨ `train_x` ã«ã•ã£ãã®åˆ—ã¨ `id` ã‚’é™¤ã„ãŸã‚‚ã®, `test_x` ã« `id` ã‚’é™¤ã„ãŸã‚‚ã®ãŒå…¥ã‚‹ğŸ™Œ


![bg right h:400](img/image-25.png)


---


<!-- _header: 1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->

### âœ… ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†!

<div class="def">

### ä»Šã®çŠ¶æ³æ•´ç†

- `train_x` $\cdots$ ãƒ¢ãƒ‡ãƒ«ã«å…¥åŠ›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿(æ¥ç¶šæ™‚é–“,ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°,etc...)
- `train_y` $\cdots$  ãƒ¢ãƒ‡ãƒ«ã®å‡ºåŠ›ã®ç›®æ¨™(æ”»æ’ƒ? é€šå¸¸?)
- `test_x` $\cdots$ äºˆæ¸¬å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿


ãŒå…¥ã£ã¦ã‚‹

</div>




---

<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† -->


âœ… **ãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ãƒ¢ãƒ‡ãƒ«ã«å…¥ã‚Œã‚‹å‰ã«å‡¦ç†ã‚’ã™ã‚‹ã“ã¨ã§å­¦ç¿’ã®å®‰å®šæ€§ã‚„ç²¾åº¦ã‚’å‘ä¸Š**

(æ¥µç«¯ãªä¾‹... å¹³å‡ãŒ $10^{18}$ ã®åˆ—ãŒã‚ã£ãŸã‚‰ã™ãã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã—ã¦ã—ã¾ã†ã®ã§å¹³å‡ã‚’å¼•ã)


<div style="text-align: center;">


ä»Šå›ã¯å„åˆ—ã«å¯¾ã—ã¦ã€Œ<span class="lined">**æ¨™æº–åŒ–**</span>ã€ã‚’ã—ã¾ã™


</div>

---

<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† -->

<div class="def">

### æ¨™æº–åŒ–

$$
\large x' = \dfrac{x - \mu}{\sigma} 
$$



<div style="text-align: center;">

( $\mu$ ã¯å¹³å‡, $\sigma$ ã¯æ¨™æº–åå·®)
</div>


</div>

1. å¹³å‡ $\mu_1$ ã®ãƒ‡ãƒ¼ã‚¿ã®å…¨ã¦ã®è¦ç´ ã‹ã‚‰ $\mu_2$ ã‚’å¼•ãã¨,å¹³å‡ã¯ $\mu_1 - \mu_2$
2. æ¨™æº–åå·® $\sigma_1$ ã®ãƒ‡ãƒ¼ã‚¿ã®å…¨ã¦ã®è¦ç´ ã‚’ $\sigma_2$ ã§å‰²ã‚‹ã¨,æ¨™æº–åå·®ã¯ $\sigma_1/\sigma_2$
  
<div style="text-align: center;">

â‡¨ æ¨™æº–åŒ–ã§ <span class="lined">**å¹³å‡ã‚’0,æ¨™æº–åå·®ã‚’1**</span> ã«ã§ãã‚‹

</div>

<div class="cite">

åˆæœŸåŒ–ã®éš›ã®è­°è«–ã‚’æ€ã„å‡ºã™ã¨ã“ã®ã‚ˆã†ãªã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ã¯è‡ªç„¶ãªç™ºæƒ³ã ã¨æ€ã„ã¾ã™.
NN ã®å…¥åŠ›ã®æ¨™æº–åŒ–ã«ã¤ã„ã¦ã¯, LeCun, Yann, et al. "E cient BackProp." Lecture Notes in Computer Science 1524 (1998): 5-50.ã€€ã«ã‚‚ã†å°‘ã—è©³ã—ãè­°è«–ãŒè¼‰ã£ã¦ã„ãŸã®ã§æ°—ã«ãªã‚‹äººã¯èª­ã‚“ã§ã¿ã¦ãã ã•ã„.

</div>

---

<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† -->

âœ… `scikit-learn` ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® `StandardScaler` ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†ã¨,
ç°¡å˜ã«æ¨™æº–åŒ–ã§ãã‚‹ï¼

```python
# sklearn.preprocessing ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹StandardScalerã‚’ä½¿ã†
from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()

# è¨ˆç®—ã«å¿…è¦ãªé‡ (å¹³å‡,æ¨™æº–åå·®) ã‚’è¨ˆç®—
scaler.fit(train_x)

# å®Ÿéš›ã«å¤‰æ›
train_x = scaler.transform(train_x)
test_x = scaler.transform(test_x)
```

<div class="cite">

`scalar.fit` ã«ã‚ˆã£ã¦å¼•æ•°ã§æ¸¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®å„åˆ—ã”ã¨ã®å¹³å‡ã¨æ¨™æº–åå·®ãŒè¨ˆç®—ã•ã‚Œ, `scalar` ã«ä¿å­˜ã•ã‚Œã¾ã™. ãã—ã¦,`scalar.transform` ã«ã‚ˆã£ã¦ãƒ‡ãƒ¼ã‚¿ãŒå®Ÿéš›ã«æ¨™æº–åŒ–ã•ã‚Œã¾ã™. å‹˜ãŒã„ã„äººã¯ã€Œ`test` ã«å¯¾ã—ã¦ã‚‚ `train_x` ã§è¨ˆç®—ã—ãŸå¹³å‡ã¨æ¨™æº–åå·®ã‚’ä½¿ã£ã¦æ¨™æº–åŒ–ã—ã¦ã„ã‚‹ã‘ã©å¤§ä¸ˆå¤«ãªã®ã‹ï¼Ÿã€ã¨æ€ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã­. çµè«–ã‹ã‚‰è¨€ã†ã¨ãã†ãªã®ã§ã™ãŒæ„å›³ã—ã¦ã„ã¾ã™. ã“ã“ã«ç†ç”±ã‚’æ›¸ã„ãŸã‚‰ä¿¡ã˜ã‚‰ã‚Œãªã„ãã‚‰ã„ã¯ã¿å‡ºã¦ã—ã¾ã£ãŸã®ã§, çœç•¥ã—ã¾ã™. èˆˆå‘³ãŒã‚ã‚‹äººã¯ã€ŒKaggleã§å‹ã¤ãƒ‡ãƒ¼ã‚¿åˆ†æã®æŠ€è¡“ã€p.124 ãªã©ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„.

</div>

---


<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† -->

```python
train_x
```

```python
test_x
```

ãªã©ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨,ç¢ºã‹ã«ä½•ã‹ã—ã‚‰ã®å¤‰æ›ãŒã•ã‚Œã¦ã„ã‚‹ï¼ âœŠ
(ã¤ã„ã§ã«çµæœãŒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å˜ãªã‚‹äºŒæ¬¡å…ƒé…åˆ— (`np.ndarray`) ã«å¤‰æ›ã•ã‚Œã¦ã‚‹)


<div class="cite">

æœ€åˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã£ã½ã„æƒ…å ±ã‚’æŒã£ãŸã¾ã¾è¨ˆç®—ã‚’é€²ã‚ãŸã„å ´åˆã¯,`train_x[:] = scaler.transform(train_x)`ã®ã‚ˆã†ã«ã™ã‚‹ã¨è‰¯ã„ã§ã™. 

</div>

---

<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† -->

ã®ã§ `train_y` ã‚‚ã“ã“ã§ä¸­èº«ã‚’å–ã‚Šå‡ºã—ã¦ `np.ndarray` ã«ã—ã¦ãŠã.

1. `train_y.values` ã§ ä¸­èº«ã®å€¤ã‚’å–ã‚Šå‡ºã›ã‚‹.
2. `arr.reshape(-1, 1)` ã§ `arr` ã‚’ $N \times 1$ ã®å½¢ã«å¤‰æ›ã§ãã‚‹


```python
train_y = train_y.values.reshape(-1, 1)
```

<div class="cite">

`np.ndarray` ã®ãƒ¡ã‚½ãƒƒãƒ‰ `reshape` ã¯ãã®åã®é€šã‚Šé…åˆ—ã®å½¢ã‚’å¤‰ãˆã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™. ãã—ã¦ `-1` ã¯ã€Œä»–ã®æ¬¡å…ƒã®è¦ç´ æ•°ã‹ã‚‰è‡ªå‹•çš„ã«æ±ºå®šã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™.
ä¾‹ãˆã°, $3 \times 4$ ã®é…åˆ—ã«å¯¾ã—ã¦ `.reshape(-1, 2)` ã¨ã™ã‚‹ã¨ $6 \times 2$ ã«ã—ã¦ãã‚Œã¾ã™. (2æ¬¡å…ƒç›®ãŒ $2$ ã¨ç¢ºå®šã—ã¦ã„ã‚‹ã®ã§å‹æ‰‹ã« $6$ ã¨å®šã¾ã‚‹)


</div>



---


<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ -->

<div style="text-align: center;">

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã—ã¦ãŠã

<br>


</div>


![center h:200](img/valid.png)



<div class="cite">

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰å‡¦ç†ã¨å‘¼ã¶äººã¯ã„ãªã„ã¨æ€ã„ã¾ã™ãŒã“ã“ã§ã‚„ã£ã¦ãŠãã¾ã™.

</div>

---

<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ -->


<div class="box">

## `sklearn.model_selection.train_test_split` ã«ã‚ˆã‚‹åˆ†å‰²

`train_test_split(train_x, train_y, test_size=0.3, random_state=34)`

- `train_x`, `train_y`: åˆ†å‰²ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
- `test_size`: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å‰²åˆ
- `random_state`: <span class="lined">**ä¹±æ•°ã®ã‚·ãƒ¼ãƒ‰**</span> **ğŸ‘ˆé‡è¦ï¼ï¼**


</div>

---

<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ -->

`scikit-learn` ã® `train_test_split` ã‚’ä½¿ã†ã¨ç°¡å˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã§ãã‚‹ï¼


```python
from sklearn.model_selection import train_test_split
train_x, val_x, train_y, val_y = train_test_split(train_x, train_y, test_size=0.3, random_state=34)
```
---


<!-- _header: ä¹±æ•°ã‚·ãƒ¼ãƒ‰ã‚’å›ºå®šã—ã‚ˆã†ï¼ï¼ -->

<div style="text-align: center;">


ä¹±æ•°ã«åŸºã¥ãè¨ˆç®—ãŒãŸãã•ã‚“

â‡©

å®Ÿè¡Œã™ã‚‹ãŸã³ã«çµæœãŒå¤‰ã‚ã£ã¦,
**ã‚ã¡ã‚ƒãã¡ã‚ƒå›°ã‚‹ğŸ˜¥**

â‡©

ä¹±æ•°ã‚·ãƒ¼ãƒ‰ã‚’å›ºå®šã™ã‚‹ã¨,
æ¯å›åŒã˜çµæœã«ãªã£ã¦
<span class="dot-text">**å†ç¾æ€§ç¢ºä¿**</span>


</div>





![bg right h:550](img/image-15.png)

<div class="cite">

å®Ÿéš›ã¯ãã‚“ãªç´ æœ´ãªä¸–ã®ä¸­ã§ã‚‚ãªã, ç’°å¢ƒå·®ç•°ã§ã‚ã£ãŸã‚Š, ä¸¦åˆ—å‡¦ç†ã‚’ã—ãŸã¨ã (ã¨ãã« GPU ãŒçµ¡ã‚“ã ã¨ã) ã«ã¯å˜ã«ä¹±æ•°ã‚·ãƒ¼ãƒ‰ã‚’å›ºå®šã™ã‚‹ã‚ˆã†ãªè¦‹ãŸç›®ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚‚çµæœãŒå¤‰ã‚ã‚ŠãŒã¡ã§, å›°ã‚‹ã“ã¨ãŒå¤šã„ã§ã™. å¯¾å‡¦æ³•ã‚‚ã„ã‚ã„ã‚è€ƒãˆã‚‰ã‚Œã¦ã„ã‚‹ã®ã§, æ°—ã«ãªã‚‹äººã¯ jax ã®ä¹±æ•°ç”Ÿæˆã®ä»•çµ„ã¿ãªã©ã‚’èª¿ã¹ã¦ã¿ã‚‹ã¨é¢ç™½ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

</div>



---


<!-- _header: 1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç† - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ -->



(`train_x`, `train_y`) ã‚’ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿:æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ = 7:3 ã«åˆ†å‰²



```python
from sklearn.model_selection import train_test_split
train_x, val_x, train_y, val_y = train_test_split(train_x, train_y, test_size=0.3, random_state=34)
```

çµæœã‚’ç¢ºèªã™ã‚‹ã¨...


```python
train_x.shape
```

```python
val_x.shape
```

ç¢ºã‹ã« 7:3 ãã‚‰ã„ã«åˆ†å‰²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹

---

<!-- _header: 1-3. PyTorchã«å…¥åŠ›ã§ãã‚‹å½¢ã«  -->


âœ…ã€€**PyTorchã§æ‰±ãˆã‚‹å½¢ã«ã™ã‚‹**


---
<!-- _header: 1-3. PyTorchã«å…¥åŠ›ã§ãã‚‹å½¢ã«  -->

æ•°ã¨ã—ã¦ **Tensorå‹** ã‚’ä½¿ã£ã¦è‡ªå‹•å¾®åˆ†ãªã©ã‚’è¡Œã†

```python
>>> x = torch.tensor(2.0, requires_grad=True)
>>> def f(x):
...     return x ** 2 + 4 * x + 3
... 
>>> y = f(x)
>>> y.backward()
>>> x.grad
tensor(8.)
```

( $f(x) = x^2 + 4x + 3$ ã® $x = 2$ ã«ãŠã‘ã‚‹å¾®åˆ†ä¿‚æ•° $8$ )


â‡¨ <span class="lined">**ãƒ‡ãƒ¼ã‚¿ã‚’Tensorå‹ã«ç›´ã—ã¦ãŠãå¿…è¦ã‚ã‚Š**</span>



---

<!-- _header: å†æ²: `Tensor` å‹ã®ã¤ãã‚Šã‹ãŸ -->


<div class="box" style="border-width: 3px;">

## `torch.tensor(data, requires_grad=False)`

- `data`: ä¿æŒã™ã‚‹ãƒ‡ãƒ¼ã‚¿(é…åˆ—**ã£ã½ã„**ã‚‚ã®ãªã‚‰ãªã‚“ã§ã‚‚)
  - ãƒªã‚¹ãƒˆ,ã‚¿ãƒ—ãƒ«, <span style="color: red;">**Numpyé…åˆ—**</span>, ã‚¹ã‚«ãƒ©....
- `requires_grad`: å‹¾é… (gradient)ã‚’ä¿æŒã™ã‚‹ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `False`
  - å‹¾é…ã®è¨ˆç®—(è‡ªå‹•å¾®åˆ†)ã‚’è¡Œã†å ´åˆã¯ `True` ã«ã™ã‚‹ 
  - ã“ã®ã‚ã¨ã“ã„ã¤ã‚’å¾®åˆ†ã®è¨ˆç®—ã«ä½¿ã„ã¾ã™ã‚ˆã€œã¨ã„ã†è¡¨æ˜



</div>


---
<!-- _header: 1-3. PyTorchã«å…¥åŠ›ã§ãã‚‹å½¢ã«  -->



<div style="text-align: center;">

âš ï¸ æˆ‘ã€…ãŒå‹¾é…é™ä¸‹æ³•ã§ä½¿ã†ã®ã¯,

### å„ **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** ã®æå¤±ã«å¯¾ã™ã‚‹å‹¾é…

â‡©

**å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å‹¾é…ã¯ä¸è¦ãªã®ã§ `requires_grad=True` ã¨ã™ã‚‹å¿…è¦ã¯ãªã„ã“ã¨ã«æ³¨æ„ï¼**

</div>


---

<!-- _header: 1-3. PyTorchã«å…¥åŠ›ã§ãã‚‹å½¢ã«  -->

## âœ…ã€€å˜ã«ã“ã‚Œã§ OKï¼

```python
import torch

train_x = torch.tensor(train_x, dtype=torch.float32)
train_y = torch.tensor(train_y, dtype=torch.float32)
val_x = torch.tensor(val_x, dtype=torch.float32)
val_y = torch.tensor(val_y, dtype=torch.float32)
test_x = torch.tensor(test_x, dtype=torch.float32)
```

---

<!-- _header: å…¨ä½“ã®æµã‚Œ1 ~ãƒ¢ãƒ‡ãƒ«ã«å…¥åŠ›ã™ã‚‹ã¾ã§ -->

<br>
<br>

<div style="text-align: center;">

## âœ… 1-0. ãƒ‡ãƒ¼ã‚¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

â‡©

## âœ…  1-1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿

â‡©

## âœ…  1-2. ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†

â‡©

## âœ…  1-2. PyTorchã«å…¥åŠ›ã§ãã‚‹å½¢ã«

</div>


---



<!-- _header: å…¨ä½“ã®æµã‚Œ -->

1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
3. ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
4. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹äºˆæ¸¬
5. é †ä½è¡¨ã¸ã®æå‡º


---



<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰-->




<div style="text-align: center;">

###### ä»Šã‹ã‚‰ã™ã‚‹ã“ã¨... 


## $f(\boldsymbol{x}; \boldsymbol{\theta})$ ã‚’ã¤ãã‚‹


![center h:320](img/layer.svg)

</div>






---



<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰-->



<br>
<br>


<div class="box">


## `torch.nn.Sequential` ã«ã‚ˆã‚‹ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰

**âœ… `torch.nn.Sequential` ã‚’ä½¿ã†ã¨ <span class="dot-text">ä¸€ç›´ç·š</span> ã®ãƒ¢ãƒ‡ãƒ«ã‚’ç°¡å˜ã«å®šç¾©ã§ãã‚‹.**


```python
import torch.nn as nn

model = nn.Sequential(
    nn.Linear(30, 32),
    nn.Sigmoid(),
    nn.Linear(32, 64),
    nn.Sigmoid(),
    nn.Linear(64, 1)
)
```


</div>

---




<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ ~ äºŒå€¤åˆ†é¡ã®å ´åˆ -->


<br>

<br>


<div class="box">


## äºŒå€¤åˆ†é¡ã®å ´åˆ

â‡¨ æœ€å¾Œã« **ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°** ã‚’ã‹ã‘ã‚‹ã“ã¨ã§å‡ºåŠ›ã‚’ $[0, 1]$ ã®ä¸­ã«åã‚ã‚‹.


```python
import torch.nn as nn

model = nn.Sequential(
    nn.Linear(30, 32),
    nn.Sigmoid(),
    nn.Linear(32, 64),
    nn.Sigmoid(),
    nn.Linear(64, 1),
    nn.Sigmoid() # <- ã“ã“é‡è¦ï¼
)
```


</div>

---


<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰-->

<div class="columns">

<div>

```python
import torch.nn as nn

model = nn.Sequential(
    nn.Linear(30, 32),
    nn.Sigmoid(),
    nn.Linear(32, 64),
    nn.Sigmoid(),
    nn.Linear(64, 1),
    nn.Sigmoid()
)
```

â‡¨ ã™ã§ã«ã“ã®æ™‚ç‚¹ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆæœŸåŒ–ãªã©ã¯çµ‚ã‚ã£ã¦ã„ã‚‹


</div>


<div>


**å¼•æ•°ã«å±¤ã‚’é †ç•ªã«æ¸¡ã™ã“ã¨ã§,ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã—ã¦ãã‚Œã‚‹ï¼**

ğŸ‘ˆ ã€Œå…¨çµåˆå±¤($W \in \mathbb{R}^{30, 32}$) $\rightarrow$ ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•° $\rightarrow$ å…¨çµåˆå±¤ ($W \in \mathbb{R}^{32, 64}$) $\rightarrow$ ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•° $\rightarrow$ å…¨çµåˆå±¤($W \in \mathbb{R}^{64, 1}$)ã€
ã¨ã„ã† MLP ã®å®šç¾©


</div>


</div>

---


<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰-->


`model.parameters()` ã¾ãŸã¯ `model.state_dict()` ã§
ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¢ºèªã§ãã‚‹

```python
model.state_dict()
```

å„å…¨çµåˆå±¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ $W^{(i)}$, $\boldsymbol{b}^{(i)}$ ãŒè¦‹ãˆã‚‹ ğŸ‘€ ğŸ‘‰

![bg right h:500](img/image-17.png)

---


<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ -->

**âœ… æ§‹ç¯‰ã—ãŸãƒ¢ãƒ‡ãƒ«ã¯é–¢æ•°ã®ã‚ˆã†ã«å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹**

```python
import torch
dummy_input = torch.rand(1, 30)
model(dummy_input)
```

`torch.rand(shape)` ã§,å½¢ãŒ `shape` ã®ãƒ©ãƒ³ãƒ€ãƒ ãª `Tensor` ãŒä½œã‚Œã‚‹


â‡¨ ãƒ¢ãƒ‡ãƒ«ã«å…¥åŠ›ã—ã¦è¨ˆç®—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãŠãï¼

(ç¾æ®µéšã§ã¯ä¹±æ•°ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒåˆæœŸåŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã«ä¹±æ•°ã‚’å…¥åŠ›ã—ã¦ã„ã‚‹ã®ã§å€¤ã«æ„å‘³ã¯ãªã„)


---


<!-- _header: 2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ -->


<div style="text-align: center;">


## âœ… $f(\boldsymbol{x}; \boldsymbol{\theta})$ ã‚’ã¤ãã‚‹

â‡©

### ã‚ã¨ã¯ã“ã‚Œã‚’å‹¾é…é™ä¸‹æ³•ã®æ çµ„ã¿ã§å­¦ç¿’ã•ã›ã‚‹ï¼


</div>


<div style="text-align: center;">
â‡©

<br>

æ€ã„å‡ºã™ã‚·ãƒªãƒ¼ã‚ºã€€

## <span class="lined">ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•</span>

</div>

---


<!-- _header: å…¨ä½“ã®æµã‚Œ -->

1. âœ… ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
2. âœ…  ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
3. ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
4. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹äºˆæ¸¬
5. é †ä½è¡¨ã¸ã®æå‡º


---

<!-- _header: å…¨ä½“ã®æµã‚Œ3. ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’-->




<div style="text-align: center;">

## 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™

â‡©

## 3-2. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…

</div>



---

<!-- _header:  ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³• -->

<div class="def">

## ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³• (SGD)

ãƒ‡ãƒ¼ã‚¿ã® **ä¸€éƒ¨** ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã‚“ã§,
ãã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹å‹¾é…ã‚’ä½¿ã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹


</div>


---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->


æ•´ç†: **æˆ‘ã€…ãŒã‚„ã‚‰ãªãã‚ƒã„ã‘ãªã„ã“ã¨**

ğŸ‘‰ ãƒ‡ãƒ¼ã‚¿ã‚’ã„ã„æ„Ÿã˜ã«é¸ã‚“ã§ä¾›çµ¦ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚‹


---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->


<div style="text-align: center;">

# ![h:60](img/torch.png) < ç§ãŒã‚„ã‚Šã¾ã™


## âœ… `torch.utils.data.Dataset`, `torch.utils.data.DataLoader`ã€€ã‚’
## ä½¿ã†ã¨ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ï¼

</div>


---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->

## ç¾çŠ¶ç¢ºèªâ˜ï¸

`train_x`, `train_y`, `val_x`, `val_y`, `test_x` ã«ãƒ‡ãƒ¼ã‚¿ãŒ 
`Tensor` å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ ¼ç´ã•ã‚Œã¦ã„ã‚‹.





---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->

### 1. Datasetã®ä½œæˆ (`Dataset`)
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ (ãƒ‡ãƒ¼ã‚¿ã®å…¥å‡ºåŠ›ã®ãƒšã‚¢ $\mathcal{D} = \{(\boldsymbol{x}_i, y_i)\}_{i=1}^N$) ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹




---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->



`TensorDataset` ã«

- ãƒ¢ãƒ‡ãƒ«ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ (`train_x`)ã¨
- å‡ºåŠ›ã®ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ (`train_y`) ã‚’æ¸¡ã™ã“ã¨ã§ `Dataset` ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹ `TensorDataset` ãŒä½œã‚Œã‚‹ï¼

```python
from torch.utils.data import TensorDataset

# ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ä½œæˆ

# å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
train_dataset = TensorDataset(train_x, train_y)
# æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
val_dataset = TensorDataset(val_x, val_y)
```




<div class="cite">

å®Ÿéš›ã¯ `torch.utils.data.Dataset` ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹ã“ã¨ã§ã‚‚ `Dataset` ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™.
ã“ã®æ–¹æ³•ã ã¨éå¸¸ã«æŸ”è»Ÿãªå‡¦ç†ãŒè¡Œãˆã‚‹ãŸã‚ãµã¤ã†ã¯ã“ã‚Œã‚’ä½¿ã„ã¾ã™ (ä»Šå›ã¯ç°¡å˜ã®ãŸã‚ã« `TensorDataset` ã‚’ä½¿ã„ã¾ã—ãŸ)


</div>



---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->

### 1. DataLoaderã®ä½œæˆ (`DataLoader`)

- `Dataset`ã‹ã‚‰ä¸€éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ (ãƒŸãƒ‹ãƒãƒƒãƒ) ã‚’å–ã‚Šå‡ºã—ã¦ä¾›çµ¦ã—ã¦ãã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ


ã¤ã¾ã‚Š....

<div class="proof">

æ•´ç†: **æˆ‘ã€…ãŒã‚„ã‚‰ãªãã‚ƒã„ã‘ãªã„ã“ã¨**

ğŸ‘‰ ãƒ‡ãƒ¼ã‚¿ã‚’ã„ã„æ„Ÿã˜ã«é¸ã‚“ã§ä¾›çµ¦ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚‹

</div>

ã‚’ã‚„ã£ã¦ãã‚Œã‚‹

--- 

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->


### 1. DataLoaderã®ä½œæˆ (`DataLoader`)
- `Dataset`ã‹ã‚‰ãƒŸãƒ‹ãƒãƒƒãƒã‚’å–ã‚Šå‡ºã—ã¦ä¾›çµ¦ã—ã¦ãã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

#### `DataLoader(dataset, batch_size=batch_size, shuffle=shuffle)`


```python
from torch.utils.data import DataLoader

batch_size = 32
train_dataloader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True, drop_last=True)
val_dataloader = DataLoader(val_dataset, batch_size=batch_size, shuffle=False)
```

â‡¨ ã“ã‚Œã‚’ foræ–‡ã§å›ã™ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã‚‹

---



<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->


<br>

### 1. DataLoaderã®ä½œæˆ(`DataLoader`å‹)



```python
for inputs, targets in train_dataloader:
    print('inputs.shape', inputs.shape)
    print('targets.shape', targets.shape)
    print('-------------')
```

<div style="text-align: center;">


â‡© 

</div>

```python
inputs.shape torch.Size([32, 30])
targets.shape torch.Size([32, 1])
-------------
inputs.shape torch.Size([32, 30])
targets.shape torch.Size([32, 1])
...
```

<div style="text-align: center;">

âœ”ï¸ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä¸€å›èµ°æŸ»ã™ã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ãŒå›ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã‚ˆã†ï¼

</div>

---

<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->


### âœ… Datasetã¨DataLoaderã®ä½œæˆ

```python
from torch.utils.data import TensorDataset, DataLoader

# ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ä½œæˆ
train_dataset = TensorDataset(train_x, train_y)
val_dataset = TensorDataset(val_x, val_y)

# ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ã®ä½œæˆ
batch_size = 32
train_dataloader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True, drop_last=True)
val_dataloader = DataLoader(val_dataset, batch_size=batch_size, shuffle=False)
```

---


<!-- _header: 3-1. ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®æº–å‚™ -->



æ•´ç†: **æˆ‘ã€…ãŒã‚„ã‚‰ãªãã‚ƒã„ã‘ãªã„ã“ã¨**

ğŸ‘‰ ãƒ‡ãƒ¼ã‚¿ã‚’ã„ã„æ„Ÿã˜ã«é¸ã‚“ã§ä¾›çµ¦ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚‹


<div style="text-align: center;">

## âœ… Done!

</div>

---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

## âœ… ãƒ‡ãƒ¼ã‚¿ã¯å›ã‚‹ã‚ˆã†ã«ãªã£ãŸ

â‡¨ ã‚ã¨ã¯å­¦ç¿’ã‚’å®Ÿè£…ã™ã‚Œã°OKï¼

### TODOãƒªã‚¹ãƒˆ

1. æå¤±é–¢æ•°ã‚’è¨­å®šã™ã‚‹
2. å‹¾é…ã®è¨ˆç®—ã‚’è¡Œã†
3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’è¡Œã†

---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…: æå¤±é–¢æ•°ã®è¨­å®š -->

<br>
<br>


## 1. æå¤±é–¢æ•°ã¯ä½•ã®ãŸã‚ã«ã‚ã‚‹ã®ã‹ï¼Ÿ


![center h:480](img/frame.png)

---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…: æå¤±é–¢æ•°ã®è¨­å®š -->

ä»Šå›ã®è©•ä¾¡æŒ‡æ¨™ ğŸ‘‰ **æ­£è§£ç‡ï¼**  

---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…: æå¤±é–¢æ•°ã®è¨­å®š -->


<div style="text-align: center;">


ä»Šã¾ã§ã¯è©•ä¾¡æŒ‡æ¨™ã‚‚ã™ã¹ã¦å¹³å‡äºŒä¹—å’Œèª¤å·®ã ã£ãŸ

â‡©

å¹³å‡äºŒä¹—èª¤å·®ã¯å¾®åˆ†å¯èƒ½ãªã®ã§ã“ã‚Œã‚’ <span class="dot-text">æå¤±é–¢æ•°</span> ã¨ã—ã¦å‹¾é…é™ä¸‹æ³•ã§æœ€é©åŒ–ã™ã‚Œã°
<span class="dot-text">è©•ä¾¡æŒ‡æ¨™ã§ã‚ã‚‹</span> å¹³å‡äºŒä¹—èª¤å·®ã‚‚æœ€é©åŒ–ã§ããŸ

</div>


---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£…: æå¤±é–¢æ•°ã®è¨­å®š -->

æ­£è§£ç‡ã¯ç›´æ¥æœ€é©åŒ–ã§ãã‚‹ï¼Ÿ
# â‡¨ <span style="color: red;">No!!</span> 

---

<!-- _header: æ­£è§£ç‡ã®å¾®åˆ† -->


**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¾®å°ã«å¤‰åŒ–ã•ã›ã¦ã‚‚
æ­£è§£ç‡ã¯å¤‰åŒ–ã—ãªã„ï¼**

â‡¨ æ­£è§£ç‡ã¯,

- **ã»ã¨ã‚“ã©ã®ç‚¹ã§å¾®åˆ†ä¿‚æ•° $0$**
- **å¤‰ã‚ã‚‹ã¨ã“ã‚ã‚‚å¾®åˆ†ä¸å¯èƒ½**

<div style="text-align: center;">

â‡©
<span class="lined">**å‹¾é…é™ä¸‹æ³•ã§æœ€é©åŒ–ã§ããªã„**</span>

</div>


![bg right h:600](img/logistic_regression.png)

<div class="cite">

å³ã®ã‚°ãƒ©ãƒ•ã¯, é©å½“ã«ä½œã£ãŸäºŒå€¤åˆ†é¡ ($\mathbb{R}^2 \to \{0, 1\}$) ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ã¨ã„ã†ãƒ¢ãƒ‡ãƒ«ã§è§£ã„ãŸã¨ãã®ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¹³é¢ä¸Šã®æ­£è§£ç‡ã‚’ãƒ—ãƒ­ãƒƒãƒˆã—ã¦ã¿ãŸã‚‚ã®ã§ã™ã€‚ã“ã‚Œã‚’è¦‹ã‚Œã°ã»ã¨ã‚“ã©ã®ã¨ã“ã‚ãŒå¾®åˆ†ä¿‚æ•°ãŒ $0$ ($\leftrightarrow$ å¹³å¦) ã§ã€å¤‰ã‚ã‚‹ã¨ã“ã‚ã‚‚å¾®åˆ†ä¸å¯ ($\leftrightarrow$ é‹­ã„) ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
</div>

---

<!-- _header: æ­£è§£ç‡ã‚’é–“æ¥çš„ã«æœ€é©åŒ–ã™ã‚‹ -->

### ã©ã†ã™ã‚‹ã‹ï¼Ÿ

â‡¨ ã“ã†ã„ã†åˆ†é¡ã‚’è§£ãã®ã«å‘ã„ã¦ã„ã‚‹æå¤±é–¢æ•°ã‚’ä½¿ã£ã¦ **é–“æ¥çš„ã«** æ­£è§£ç‡ã‚’ä¸Šã’ã‚‹.


---

<!-- _header: Binary Cross Entropy Loss -->

<div class="def">

## äºŒå€¤äº¤å·®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼èª¤å·® (Binary Cross Entropy Loss)

$$
\large - \dfrac{1}{N} \sum_{i=1}^{N} \ y_i \log(f(x_i)) + (1 - y_i) \log(1 - f(x_i))
$$

</div>



---


<!-- _header: Binary Cross Entropy Loss -->


$$
- \dfrac{1}{N} \sum_{i=1}^{N} \ y_i \log(f(x_i)) + (1 - y_i) \log(1 - f(x_i))
$$


### ç¢ºèªã—ã¦ã»ã—ã„ã“ã¨: 

<div class="columns">

<div>


- æ­£è§£ $y_i$ ã¨äºˆæ¸¬ $f(x_i)$ ãŒè¿‘ã„ã»ã©å€¤ã¯å°ã•ããªã£ã¦ã„ã‚‹.
( $y_i \in \{0, 1\}$ã€€ãªã®ã§ãã‚Œãã‚Œã®å ´åˆã«ã¤ã„ã¦è€ƒãˆã¦ã¿ã‚‹ã¨ã‚ã‹ã‚‹)
  
- å¾®åˆ†å¯èƒ½ã§ã‚ã‚‹


</div>

<div>


<br>

## ğŸ‘‰ ãªã®ã§ã€æå¤±é–¢æ•°ã¨ã—ã¦å¦¥å½“


</div>

</div>

<div class="cite">

ã“ã‚Œã‚‚ã‚„ã¯ã‚ŠäºŒä¹—å’Œèª¤å·®ã®ã¨ãã¨åŒæ§˜ã«åŒæ§˜ã«å°¤åº¦ã®æœ€å¤§åŒ–ã¨ã—ã¦ <span class="dot-text">å°å‡º</span> ã§ãã¾ã™.

</div>

---

<!-- _header: Binary Cross Entropy Loss -->

## âœ… PyTorch ã§ã¯, `torch.nn.BCELoss` ã§ä½¿ãˆã‚‹ï¼

```python
import torch

criterion = torch.nn.BCELoss()

y = torch.tensor([0.0, 1.0, 1.0])
pred = torch.tensor([0.1, 0.9, 0.2])

loss = criterion(pred, y)
print(loss)   # => tensor(0.6067)
```  


---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

### TODOãƒªã‚¹ãƒˆ

â˜‘ï¸ 1. æå¤±é–¢æ•°ã‚’è¨­å®šã™ã‚‹
2. å‹¾é…ã®è¨ˆç®—ã‚’è¡Œã†
3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’è¡Œã†

---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

# 2. å‹¾é…ã®è¨ˆç®—ã‚’è¡Œã†

<br>

<div style="text-align: center;">

ã‚„ã‚Šã‹ãŸã¯....ï¼Ÿ

</div>

---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->


å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©
å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(),   å®šç¾©â†’è¨ˆç®—â†’backward(), å®šç¾©



---


<!-- _header: æå¤±ã«å¯¾ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹¾é…ã®è¨ˆç®—ä¾‹ -->

<br>


```python
# ã“ã“ã‹ã‚‰
model = nn.Sequential(
    nn.Linear(30, 32),
    ...
)
# ã“ã“ã¾ã§ãŒ "å®šç¾©"

dummy_input = torch.rand(1, 30)
dummy_target = torch.rand(1, 1)

# "è¨ˆç®—"
pred = model(dummy_input)
loss = criterion(pred, dummy_target)

# "backward()"
loss.backward()
```


---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

### âœ”ï¸ ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ 
1. `loss` ã«å¯¾ã™ã‚‹å‹¾é…ã‚’è¨ˆç®—ã—ã¦ã„ã‚‹

```python
# backward
loss.backward()
```
2. å‹¾é…ã¯ **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** ã«å¯¾ã—ã¦è¨ˆç®—ã•ã‚Œã‚‹

```python
for param in model.parameters():
    print(param.grad)
```

(`dummy_input`, `dummy_target`ã¯`requires_grad=False`ãªã®ã§å‹¾é…ã¯è¨ˆç®—ã•ã‚Œãªã„)



---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

### TODOãƒªã‚¹ãƒˆ

â˜‘ï¸ 1. æå¤±é–¢æ•°ã‚’è¨­å®šã™ã‚‹
â˜‘ï¸ 2. å‹¾é…ã®è¨ˆç®—ã‚’è¡Œã†
3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’è¡Œã†


---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

```python
for epoch in range(epochs):
    for inputs, targets in train_dataloader:
        # è¨ˆç®—
        outputs = model(inputs)
        loss = criterion(outputs, targets)

        # backward
        loss.backward()

        # -----------------------
        # ....
        # ã“ã“ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’æ›¸ã
        # ....
        # -----------------------
```


---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

ã“ã‚Œã¾ã§ã¯,æˆ‘ã€…ãŒæ‰‹å‹•(?)ã§æ›´æ–°ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãŸ

# â‡¨ ![h:50](img/torch.png) < ç§ãŒã‚„ã‚Šã¾ã™



## âœ… torch.optimã®ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ã‚’ä½¿ã†ã“ã¨ã§ç°¡å˜ã«ã„ã‚ã„ã‚ãªæœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ãˆã‚‹


---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

<br>
<br>


**(âš ï¸: å®Œæˆç‰ˆã§ã¯ãªã„)**
 
```python
optimizer = optim.SGD(model.parameters(), lr=lr)

# å­¦ç¿’ãƒ«ãƒ¼ãƒ—
for epoch in range(epochs):
    for inputs, targets in train_dataloader:
        # å‹¾é…ã®åˆæœŸåŒ–
        optimizer.zero_grad()
        # è¨ˆç®—
        outputs = model(inputs)
        loss = criterion(outputs, targets)

        # backward
        loss.backward()
        
        # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ›´æ–°
        optimizer.step()
```

---



<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

<div class="def">

âœ… **`optimizer = optim.SGD(params)` ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§**
**`params` ã‚’å‹¾é…é™ä¸‹æ³•ã§æ›´æ–°ã™ã‚‹ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ã‚’ä½œæˆã§ãã‚‹ï¼**

</div>


<div style="text-align: center;">

ãŸã¨ãˆã° Adam ãŒä½¿ã„ãŸã‘ã‚Œã° `optimizer = optim.Adam(params)` ã¨ã™ã‚‹ã ã‘ã§OKï¼

â‡©

å‹¾é…ã‚’è¨ˆç®—ã—ãŸã‚ã¨ã« `optimizer.step()` ã‚’å‘¼ã¶ã¨, 
å„ `Tensor` ã«è¼‰ã£ã¦ã„ã‚‹å‹¾é…ã®å€¤ã‚’ä½¿ã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ãã‚Œã‚‹


</div>


---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

**âš ï¸ æ³¨æ„ âš ï¸**

`optimizer.step()` ã§ä¸€å›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ãŸã³ã«
`optimizer.zero_grad()` ã§å‹¾é…ã‚’åˆæœŸåŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼

(ã“ã‚Œã‚’ã—ãªã„ã¨å‰å›ã®`backward` ã®çµæœãŒæ®‹ã£ã¦ã„ã¦ãŠã‹ã—ããªã‚‹)

---




â‡© æ¬¡ã®ãƒšãƒ¼ã‚¸...

# å­¦ç¿’ã®å…¨ä½“åƒã‚’è²¼ã‚Šã¾ã™ï¼ï¼ï¼





---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

<br>
<br>

```python
from torch import nn


model = nn.Sequential(
    nn.Linear(30, 32),
    nn.Sigmoid(),
    nn.Linear(32, 64),
    nn.Sigmoid(),
    nn.Linear(64, 1),
    nn.Sigmoid()
)

optimizer = torch.optim.SGD(model.parameters(), lr=1e-2)
criterion = torch.nn.BCELoss()

n_epoch = 100
for epoch in range(n_epoch):
    running_loss = 0.0

    for inputs, targets in train_dataloader:
        # å‰ã®å‹¾é…ã‚’æ¶ˆã™
        optimizer.zero_grad()

        # è¨ˆç®—
        outputs = model(inputs)
        loss = criterion(outputs, targets)

        # backwardã§å‹¾é…ã‚’è¨ˆç®—
        loss.backward()

        # optimizerã‚’ä½¿ã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°
        optimizer.step()

        running_loss += loss.item()

    val_loss = 0.0
    with torch.no_grad():
        for inputs, targets in val_dataloader:
            outputs = model(inputs)
            loss = criterion(outputs, targets)
            val_loss += loss.item()

    # ã‚¨ãƒãƒƒã‚¯ã”ã¨ã®æå¤±ã®è¡¨ç¤º
    train_loss = running_loss / len(train_dataloader)
    val_loss = val_loss / len(val_dataloader)
    print(f'Epoch {epoch + 1} - Train Loss: {train_loss:.4f} - Val Loss: {val_loss:.10f}')
```

---


<!-- _header: å„è¡Œã®è§£èª¬ (foræ–‡ä»¥é™) -->



- 1è¡Œç›®. `for epoch in range(n_epoch)` .... ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã‚’ `n_epoch` å›ã¾ã‚ã™
- 2è¡Œç›®. `running_loss = 0.0` .... 1ã‚¨ãƒãƒƒã‚¯ã”ã¨ã®è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã®æå¤±ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
- 4è¡Œç›®. `for inputs, targets in train_dataloader` .... è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã‚’1ãƒãƒƒãƒãšã¤å–ã‚Šå‡ºã™(`DataLoader`ã®é …ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼)
- 6è¡Œç›®. `optimizer.zero_grad()` .... å‹¾é…ã‚’åˆæœŸåŒ–ã™ã‚‹. äºŒã¤å‰ã®ãƒšãƒ¼ã‚¸ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã§ã™ï¼
- 9, 10è¡Œç›®.  `outputs = ...` .... æå¤±ã®è¨ˆç®—ã‚’ã—ã¾ã™.

---

<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

- 13è¡Œç›®. `loss.backward()` .... å‹¾é…ã®è¨ˆç®—ã§ã™.ã“ã‚Œã«ã‚ˆã£ã¦`model`ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã« **æå¤±ã«å¯¾ã™ã‚‹** å‹¾é…ãŒè¨˜éŒ²ã•ã‚Œã¾ã™
- 16è¡Œç›®. `optimizer.step()` .... `optimizer`ãŒè¨˜éŒ²ã•ã‚ŒãŸå‹¾é…ã«åŸºã¥ã„ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã™.
- 18è¡Œç›®. `running_loss += loss.item()` .... 1ãƒãƒƒãƒåˆ†ã®æå¤±ã‚’`running_loss`ã«è¶³ã—ã¦ãŠãã¾ã™.
  
- 20è¡Œç›®~25è¡Œç›®. 1ã‚¨ãƒãƒƒã‚¯åˆ†ã®å­¦ç¿’ãŒçµ‚ã‚ã£ãŸã‚‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã§ã®æå¤±ã‚’è¨ˆç®—ã—ã¾ã™. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹ã¯å­¦ç¿’ã«å½±éŸ¿ã•ã›ãªã„ã®ã§å‹¾é…ã‚’è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“.ã—ãŸãŒã£ã¦`torch.no_grad()`ã®ä¸­ã§è¨ˆç®—ã—ã¾ã™.

---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

- 28è¡Œç›®ã€œ30è¡Œç›®. 1ã‚¨ãƒãƒƒã‚¯åˆ†ã®å­¦ç¿’ãŒçµ‚ã‚ã£ãŸã‚‰, è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¨æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã®æå¤±ã‚’è¡¨ç¤ºã—ã¾ã™. `len(train_dataloader)`ã¯è¨“ç·´ãƒ‡ãƒ¼ã‚¿ãŒä½•å€‹ã®ãƒŸãƒ‹ãƒãƒƒãƒã«åˆ†å‰²ã•ã‚ŒãŸã‹ã‚’è¡¨ã™æ•°, `len(val_dataloader)`ã¯æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ãŒä½•å€‹ã®ãƒŸãƒ‹ãƒãƒƒãƒã«åˆ†å‰²ã•ã‚ŒãŸã‹ã‚’è¡¨ã™æ•°ã§ã™. ã“ã‚Œã§å‰²ã£ã¦å¹³å‡ã®å€¤ã«ã—ã¾ã™.
  
- 32è¡Œç›®. æå¤±ã‚’å‡ºåŠ›ã—ã¾ã™.

---


<!-- _header: 3.2 ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•ã®å®Ÿè£… -->

### TODOãƒªã‚¹ãƒˆ

â˜‘ï¸ 1. æå¤±é–¢æ•°ã‚’è¨­å®šã™ã‚‹
â˜‘ï¸ 2. å‹¾é…ã®è¨ˆç®—ã‚’è¡Œã†
â˜‘ï¸  3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’è¡Œã†

---

<!-- _header: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ -->

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã§ ä»Šå›ã®è©•ä¾¡æŒ‡æ¨™ã§ã‚ã‚‹æ­£è§£ç‡ãŒã©ã®ãã‚‰ã„ã«ãªã£ã¦ã„ã‚‹ã‹è¨ˆç®—ã—ã¦ãŠãï¼

ğŸ‘‰ ã“ã‚ŒãŒãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹äºˆæ¸¬ç²¾åº¦ã®ã‚ã‚„ã™.


---

<!-- _header: æ­£è§£ç‡ã®è¨ˆç®— -->

1. $0.5$ ä»¥ä¸Šãªã‚‰ç•°å¸¸ã¨äºˆæ¸¬ã™ã‚‹.

```python
val_pred = model(val_x) > 0.5
```

2. `torch.Tensor` ã‹ã‚‰ `numpy.ndarray` ã«å¤‰æ›ã™ã‚‹

```python
val_pred_np = val_pred.numpy().astype(int)
val_y_np = val_y.numpy().astype(int)
```


2. `sklearn.metrics` ã® `accuracy_score` ã‚’ä½¿ã£ã¦æ­£è§£ç‡ã‚’è¨ˆç®—ã™ã‚‹

```python
from sklearn.metrics import accuracy_score
accuracy_score(val_y_np, val_pred_np) # => (ä¹ã†ã”æœŸå¾…. ã“ã‚Œã‚’é«˜ãã§ãã‚‹ã‚ˆã†ã«é ‘å¼µã‚‹)
```

---

<!-- _header: 3. å­¦ç¿’ãŒå®Œäº†ï¼ï¼ï¼ -->

<br>

### \+ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€€ å­¦ç¿’æ›²ç·šã‚’æ›¸ã„ã¦ãŠã“ã†

1. å„ã‚¨ãƒãƒƒã‚¯ã®æå¤±ã‚’è¨˜éŒ²ã™ã‚‹é…åˆ—ã‚’ä½œã£ã¦ãŠã

```python
train_losses = []
val_losses = []
```

1. å…ˆã»ã©ã®å­¦ç¿’ã®ã‚³ãƒ¼ãƒ‰ã®ä¸­ã«,æå¤±ã‚’è¨˜éŒ²ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹

```python
train_loss = running_loss / len(train_dataloader)
val_loss = val_loss / len(val_dataloader)
train_losses.append(train_loss) # ã“ã‚ŒãŒè¿½åŠ ã•ã‚ŒãŸ
val_losses.append(val_loss)ã€€# ã“ã‚ŒãŒè¿½åŠ ã•ã‚ŒãŸ
print(f'Epoch {epoch + 1} - Train Loss: {train_loss:.4f} - Val Loss: {val_loss:.10f}')
```

(å„ ã‚¨ãƒãƒƒã‚¯ã§æ­£è§£ç‡ã‚‚è¨ˆç®—ã™ã‚‹ã¨ã‚ˆã‚Šå®Ÿé¨“ãŒã—ã‚„ã™ããªã‚‹ã®ã§å®Ÿè£…ã—ã¦ã¿ã‚ˆã†)

---

<!-- _header: 3. å­¦ç¿’ãŒå®Œäº†ï¼ï¼ï¼ -->

<br>

#### \+ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€€ å­¦ç¿’æ›²ç·šã‚’æ›¸ã„ã¦ãŠã“ã†

`matplotlib` ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã“ã¨ã§ã‚°ãƒ©ãƒ•ãŒæ›¸ã‘ã‚‹

```python
# matplotlib.pyplot ã‚’ pltã¨ã„ã†åå‰ã§import
import matplotlib.pyplot as plt
```

```python
plt.plot(train_losses, label='train')
plt.plot(val_losses, label='val')
plt.legend()
plt.xlabel('epoch')
plt.ylabel('loss')
plt.show()
```

â‡¨ ã„ã„æ„Ÿã˜ã®ãƒ—ãƒ­ãƒƒãƒˆãŒè¦‹ã‚Œã‚‹



---



<!-- _header: å…¨ä½“ã®æµã‚Œ -->

1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
2. ãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
3. ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
4. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹äºˆæ¸¬
5. é †ä½è¡¨ã¸ã®æå‡º

---


<!-- _header: 4. æ–°è¦ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹äºˆæ¸¬ -->

## ãã†ã„ãˆã° ğŸ’¡

`test_x` ã«äºˆæ¸¬ã—ãŸã„æœªçŸ¥ã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹


```python
model(test_x)
```

â‡¨ äºˆæ¸¬çµæœãŒå‡ºã‚‹

---


<!-- _header: 5. é †ä½è¡¨ã¸ã®æå‡º -->


```python
import csv

def write_pred(predictions, filename='submit.csv'):
    pred = predictions.squeeze().tolist()
    assert set(pred) == set([True, False])
    pred_class =  ["attack" if x else "normal" for x in pred]
    sample_submission = pd.read_csv('sample_submission.csv')
    sample_submission['pred'] = pred_class
    sample_submission.to_csv('submit.csv', index=False)
```

ã‚’ã‚³ãƒ”ãƒš
â†’ 

---

<!-- _header:  5. é †ä½è¡¨ã¸ã®æå‡º -->

äºˆæ¸¬çµæœ (`True`, `False` ã‹ã‚‰ãªã‚‹ `Tensor`)

```python
pred = model(test_x) > 0.5
```

ã‚’ä½œã£ã¦,

```python
write_pred(pred)
```

ã™ã‚‹ã¨,

---

<!-- _header:  5. é †ä½è¡¨ã¸ã®æå‡º -->

ğŸ“‚ > submit.csv

ãŒã§ãã‚‹ï¼

ğŸ‘‰ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦, submit ã‹ã‚‰æŠ•ç¨¿ï¼ <span class="lined">**é †ä½è¡¨ã«ä¹—ã‚ã†!**</span>

![bg right h:450](img/image-19.png)

![alt text](img/image-20.png)


---

<!-- _class: lead -->
<!-- _header: 5. é †ä½è¡¨ã¸ã®æå‡º -->

# ã‚ã–ã›ã€€No.1ï¼


